# ============================================
# サンプル: スキルシステムの使用例
# ============================================
# Condition, Targeter, Effect, Skillの統合例

# 基本的なスキル構成
BasicSkillMob:
  Type: ZOMBIE
  Display: '&a基本スキルゾンビ'
  Health: 100

  Skills:
    OnTimer:
      # 単純なダメージスキル
      - name: SimpleAttack
        interval: 100  # 5秒ごと

        # ターゲッター: 最も近いプレイヤー
        targeter:
          type: NearestPlayer
          range: 20

        # 条件: 距離が5ブロック以内
        condition: 'target.distance < 5'

        # スキル実行
        skills:
          - skill: DamageSkill
            meta:
              sync: true  # ダメージは同期必須
              executeDelay: 0ms
              effectDelay: 0ms

---

# エフェクト組み合わせスキル
CombinedEffectMob:
  Type: SKELETON
  Display: '&6複合エフェクトスケルトン'
  Health: 150

  Skills:
    OnTimer:
      - name: PowerAttack
        interval: 120

        targeter:
          type: NearestPlayer
          range: 30

        condition: 'target.distance >= 5 && target.distance <= 25'

        skills:
          # 複数のエフェクトを順次適用
          - skill: PowerAttackSkill
            meta:
              sync: true
            effects:
              # ダメージ
              - type: Damage
                amount: 10

              # ノックバック
              - type: Knockback
                strength: 1.5

              # 発火
              - type: Ignite
                duration: 3s

              # パーティクル
              - type: Particle
                particle: FLAME
                count: 20

              # サウンド
              - type: Sound
                sound: ENTITY_BLAZE_SHOOT
                volume: 1.0
                pitch: 1.0

---

# 範囲攻撃スキル
AoESkillMob:
  Type: ZOMBIE
  Display: '&c範囲攻撃ゾンビ'
  Health: 200

  Skills:
    OnTimer:
      - name: AreaAttack
        interval: 200  # 10秒ごと

        # 範囲内の全プレイヤーをターゲット
        targeter:
          type: RadiusPlayers
          range: 10
          # 条件: サバイバルモードのみ
          condition: 'target.gameMode == "SURVIVAL"'

        skills:
          - skill: AoEDamageSkill
            meta:
              sync: true
            effects:
              # 警告パーティクル
              - type: Particle
                particle: EXPLOSION_LARGE
                count: 5

              # 範囲ダメージ
              - type: Damage
                amount: 15

              # 警告音
              - type: Sound
                sound: ENTITY_GENERIC_EXPLODE

---

# ポーション効果スキル
PotionEffectMob:
  Type: WITCH
  Display: '&5ポーション魔女'
  Health: 120

  Skills:
    OnTimer:
      # デバフスキル
      - name: ApplyDebuff
        interval: 150

        targeter:
          type: NearestPlayer
          range: 15

        skills:
          - skill: DebuffSkill
            meta:
              sync: true
            effects:
              # 鈍化
              - type: PotionEffect
                effectType: SLOW
                duration: 10s
                amplifier: 1

              # 弱体化
              - type: PotionEffect
                effectType: WEAKNESS
                duration: 10s
                amplifier: 0

              # 毒
              - type: PotionEffect
                effectType: POISON
                duration: 5s
                amplifier: 0

---

# メタスキル例（フェーズ実行）
MetaSkillMob:
  Type: ZOMBIE
  Display: '&dメタスキルゾンビ'
  Health: 250

  Skills:
    OnTimer:
      - name: ComplexCombo
        interval: 300  # 15秒ごと

        # メタスキル: 複数フェーズ
        type: MetaSkill

        phases:
          # フェーズ1: 準備
          - name: preparation
            targeter:
              type: Self
            meta:
              executeDelay: 0ms
              parallel: false
            skills:
              - skill: ChargeEffect
                effects:
                  - type: Particle
                    particle: ENCHANTMENT_TABLE
                    count: 30
                  - type: Sound
                    sound: BLOCK_ENCHANTMENT_TABLE_USE

          # フェーズ2: メイン攻撃（並列）
          - name: main_attack
            targeter:
              type: RadiusPlayers
              range: 15
            meta:
              executeDelay: 2s  # 2秒後
              parallel: true  # 同時実行
            skills:
              - skill: ProjectileAttack
                effects:
                  - type: Damage
                    amount: 20

              - skill: KnockbackAttack
                effects:
                  - type: Knockback
                    strength: 2.0

              - skill: VisualEffect
                effects:
                  - type: Particle
                    particle: EXPLOSION_HUGE
                    count: 10

          # フェーズ3: 後処理
          - name: cleanup
            targeter:
              type: Self
            meta:
              executeDelay: 1s
              parallel: false
            skills:
              - skill: RecoveryEffect
                effects:
                  - type: Heal
                    amount: 50
                  - type: PotionEffect
                    effectType: REGENERATION
                    duration: 5s
                    amplifier: 1

---

# 条件分岐スキル
ConditionalSkillMob:
  Type: ZOMBIE
  Display: '&e条件分岐ゾンビ'
  Health: 150

  Skills:
    OnTimer:
      # HP割合で異なるスキル
      - name: AdaptiveSkill
        interval: 100

        targeter:
          type: NearestPlayer
          range: 20

        # HP条件で分岐
        conditions:
          # HP30%以下: 緊急回復
          - condition: 'entity.health < entity.maxHealth * 0.3'
            skills:
              - skill: EmergencyHeal
                meta:
                  sync: true
                effects:
                  - type: Heal
                    amount: 100
                  - type: Particle
                    particle: HEART
                    count: 10

          # HP50%以下: 強化攻撃
          - condition: 'entity.health < entity.maxHealth * 0.5'
            skills:
              - skill: PowerAttack
                meta:
                  sync: true
                effects:
                  - type: Damage
                    amount: 25
                  - type: Sound
                    sound: ENTITY_PLAYER_ATTACK_STRONG

          # それ以外: 通常攻撃
          - default: true
            skills:
              - skill: NormalAttack
                meta:
                  sync: true
                effects:
                  - type: Damage
                    amount: 10

---

# テレポートスキル
TeleportSkillMob:
  Type: ENDERMAN
  Display: '&5テレポートエンダーマン'
  Health: 180

  Skills:
    OnTimer:
      # ランダムテレポート
      - name: RandomTeleport
        interval: 100

        targeter:
          type: Self

        condition: 'math.random() < 0.3'  # 30%の確率

        skills:
          - skill: TeleportSkill
            meta:
              sync: true
            effects:
              # テレポート前エフェクト
              - type: Particle
                particle: PORTAL
                count: 50
              - type: Sound
                sound: ENTITY_ENDERMAN_TELEPORT

              # テレポート
              - type: Teleport
                # 座標はランダム生成される想定

              # テレポート後エフェクト
              - type: Particle
                particle: PORTAL
                count: 50
              - type: Sound
                sound: ENTITY_ENDERMAN_TELEPORT

---

# メッセージ・コマンドスキル
UtilitySkillMob:
  Type: ZOMBIE
  Display: '&bユーティリティゾンビ'
  Health: 100

  Skills:
    OnTimer:
      - name: SendMessage
        interval: 200

        targeter:
          type: NearestPlayer
          range: 10

        skills:
          - skill: MessageSkill
            meta:
              sync: true
            effects:
              # メッセージ送信
              - type: Message
                message: '&c警告: 危険なゾンビが接近中！'

              # サウンド
              - type: Sound
                sound: BLOCK_NOTE_BLOCK_PLING
                pitch: 2.0

      # コマンド実行例
      - name: ExecuteCommand
        interval: 300

        targeter:
          type: NearestPlayer
          range: 15

        condition: 'target.level >= 20'

        skills:
          - skill: CommandSkill
            meta:
              sync: true
            effects:
              - type: Command
                command: 'give @s diamond 1'
                asOp: false

---

# スキルシステムのポイント:
# 1. Condition: CEL式で柔軟な条件判定
# 2. Targeter: 様々なターゲット選択方法
# 3. Effect: 複数のエフェクトを組み合わせ可能
# 4. Skill: エフェクトの実行順序と遅延を制御
# 5. MetaSkill: 複雑な行動パターンを表現
# 6. 同期/非同期: meta.syncで適切に制御